<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libsidplayfp: demo.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libsidplayfp
   &#160;<span id="projectnumber">2.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">demo.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * This file is part of libsidplayfp, a SID player engine.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Copyright 2012-2014 Leandro Nini &lt;drfiemost@users.sourceforge.net&gt;</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div><div class="line"><span class="comment"> * it under the terms of the GNU General Public License as published by</span></div><div class="line"><span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span></div><div class="line"><span class="comment"> * (at your option) any later version.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This program is distributed in the hope that it will be useful,</span></div><div class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment"> * GNU General Public License for more details.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * You should have received a copy of the GNU General Public License</span></div><div class="line"><span class="comment"> * along with this program; if not, write to the Free Software</span></div><div class="line"><span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/soundcard.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;sidplayfp/sidplayfp.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sidplayfp/SidTune.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sidplayfp/SidInfo.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sidplayfp/builders/residfp.h&gt;</span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Adjust these paths to point to existing ROM dumps if needed.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#define KERNAL_PATH  &quot;&quot;</span></div><div class="line"><span class="preprocessor">#define BASIC_PATH   &quot;&quot;</span></div><div class="line"><span class="preprocessor">#define CHARGEN_PATH &quot;&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define SAMPLERATE 48000</span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Load ROM dump from file.</span></div><div class="line"><span class="comment"> * Allocate the buffer if file exists, otherwise return 0.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">char</span>* loadRom(<span class="keyword">const</span> <span class="keywordtype">char</span>* path, <span class="keywordtype">size_t</span> romSize)</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span>* buffer = 0;</div><div class="line">    std::ifstream is(path, std::ios::binary);</div><div class="line">    <span class="keywordflow">if</span> (is.good())</div><div class="line">    {</div><div class="line">        buffer = <span class="keyword">new</span> <span class="keywordtype">char</span>[romSize];</div><div class="line">        is.read(buffer, romSize);</div><div class="line">    }</div><div class="line">    is.close();</div><div class="line">    <span class="keywordflow">return</span> buffer;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Sample application that shows how to use libsidplayfp</span></div><div class="line"><span class="comment"> * to play a SID tune from a file.</span></div><div class="line"><span class="comment"> * It uses OSS for audio output.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div><div class="line">{</div><div class="line">    <a name="_a0"></a><a class="code" href="classsidplayfp.html">sidplayfp</a> m_engine;</div><div class="line"></div><div class="line">    { <span class="comment">// Load ROM files</span></div><div class="line">    <span class="keywordtype">char</span> *kernal = loadRom(KERNAL_PATH, 8192);</div><div class="line">    <span class="keywordtype">char</span> *basic = loadRom(BASIC_PATH, 8192);</div><div class="line">    <span class="keywordtype">char</span> *chargen = loadRom(CHARGEN_PATH, 4096);</div><div class="line"></div><div class="line">    m_engine.<a name="a1"></a><a class="code" href="classsidplayfp.html#ac6a9155ee3af4bac3cd775d72db41f57">setRoms</a>((<span class="keyword">const</span> uint8_t*)kernal, (<span class="keyword">const</span> uint8_t*)basic, (<span class="keyword">const</span> uint8_t*)chargen);</div><div class="line"></div><div class="line">    <span class="keyword">delete</span> [] kernal;</div><div class="line">    <span class="keyword">delete</span> [] basic;</div><div class="line">    <span class="keyword">delete</span> [] chargen;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Set up a SID builder</span></div><div class="line">    std::auto_ptr&lt;ReSIDfpBuilder&gt; rs(<span class="keyword">new</span> <a name="_a2"></a><a class="code" href="classReSIDfpBuilder.html">ReSIDfpBuilder</a>(<span class="stringliteral">&quot;Demo&quot;</span>));</div><div class="line"></div><div class="line">    <span class="comment">// Get the number of SIDs supported by the engine</span></div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxsids = (m_engine.<a name="a3"></a><a class="code" href="classsidplayfp.html#a1aea02da25db84d61604ebbb5af5f386">info</a> ()).maxsids();</div><div class="line"></div><div class="line">    <span class="comment">// Create SID emulators</span></div><div class="line">    rs-&gt;<a name="a4"></a><a class="code" href="classReSIDfpBuilder.html#ad03f045c75aa60ed96ead0e999f27014">create</a>(maxsids);</div><div class="line"></div><div class="line">    <span class="comment">// Check if builder is ok</span></div><div class="line">    <span class="keywordflow">if</span> (!rs-&gt;<a name="a5"></a><a class="code" href="classsidbuilder.html#a23a0bb6ad1e85633d974f4cc773e9e81">getStatus</a>())</div><div class="line">    {</div><div class="line">        std::cerr &lt;&lt; rs-&gt;<a name="a6"></a><a class="code" href="classsidbuilder.html#a7672bd883c78c9dc6758d415dedb60de">error</a>() &lt;&lt; std::endl;</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Load tune from file</span></div><div class="line">    std::auto_ptr&lt;SidTune&gt; tune(<span class="keyword">new</span> <a name="_a7"></a><a class="code" href="classSidTune.html">SidTune</a>(argv[1]));</div><div class="line"></div><div class="line">    <span class="comment">// CHeck if the tune is valid</span></div><div class="line">    <span class="keywordflow">if</span> (!tune-&gt;<a name="a8"></a><a class="code" href="classSidTune.html#a85329768891916af2efdb3807128fccf">getStatus</a>())</div><div class="line">    {</div><div class="line">        std::cerr &lt;&lt; tune-&gt;<a name="a9"></a><a class="code" href="classSidTune.html#a4dfd33ace6bbd4d60621f293319f9970">statusString</a>() &lt;&lt; std::endl;</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Select default song</span></div><div class="line">    tune-&gt;<a name="a10"></a><a class="code" href="classSidTune.html#abb7346e021c624c0ec0ede4597981ea6">selectSong</a>(0);</div><div class="line"></div><div class="line">    <span class="comment">// Configure the engine</span></div><div class="line">    <a name="_a11"></a><a class="code" href="classSidConfig.html">SidConfig</a> cfg;</div><div class="line">    cfg.<a name="a12"></a><a class="code" href="classSidConfig.html#a577c7513e60a83643d5164b9a4dbc091">frequency</a> = SAMPLERATE;</div><div class="line">    cfg.<a name="a13"></a><a class="code" href="classSidConfig.html#afb1f9401f74b5801c6f552b43cf16e50">samplingMethod</a> = SidConfig::INTERPOLATE;</div><div class="line">    cfg.<a name="a14"></a><a class="code" href="classSidConfig.html#a95b15cef0a5ded03a557d422b6752b9e">fastSampling</a> = <span class="keyword">false</span>;</div><div class="line">    cfg.<a name="a15"></a><a class="code" href="classSidConfig.html#a82de01986c9d346c0a5368069a6cfb2a">playback</a> = SidConfig::MONO;</div><div class="line">    cfg.<a name="a16"></a><a class="code" href="classSidConfig.html#adc60d41cde7aedb58d24cde2aeff92a0">sidEmulation</a> = rs.get();</div><div class="line">    <span class="keywordflow">if</span> (!m_engine.<a name="a17"></a><a class="code" href="classsidplayfp.html#a455797460b63290cddbeb99d3c24a056">config</a>(cfg))</div><div class="line">    {</div><div class="line">        std::cerr &lt;&lt;  m_engine.<a name="a18"></a><a class="code" href="classsidplayfp.html#a8ad05fe52bd34636832684c6c08ca994">error</a>() &lt;&lt; std::endl;</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Load tune into engine</span></div><div class="line">    <span class="keywordflow">if</span> (!m_engine.<a name="a19"></a><a class="code" href="classsidplayfp.html#a62e5a8e252685332f8a9ddbb6f466e14">load</a>(tune.get()))</div><div class="line">    {</div><div class="line">        std::cerr &lt;&lt;  m_engine.<a class="code" href="classsidplayfp.html#a8ad05fe52bd34636832684c6c08ca994">error</a>() &lt;&lt; std::endl;</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Setup audio device</span></div><div class="line">    <span class="keywordtype">int</span> handle=::open(<span class="stringliteral">&quot;/dev/dsp&quot;</span>, O_WRONLY, 0);</div><div class="line">    <span class="keywordtype">int</span> format=AFMT_S16_LE;</div><div class="line">    ioctl(handle, SNDCTL_DSP_SETFMT, &amp;format);</div><div class="line">    <span class="keywordtype">int</span> chn=1;</div><div class="line">    ioctl(handle, SNDCTL_DSP_CHANNELS, &amp;chn);</div><div class="line">    <span class="keywordtype">int</span> sampleRate=SAMPLERATE;</div><div class="line">    ioctl(handle, SNDCTL_DSP_SPEED, &amp;sampleRate);</div><div class="line">    <span class="keywordtype">int</span> bufferSize;</div><div class="line">    ioctl(handle, SNDCTL_DSP_GETBLKSIZE, &amp;bufferSize);</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> bufferSamples = bufferSize / <span class="keyword">sizeof</span>(short);</div><div class="line"></div><div class="line">    <span class="comment">// Play</span></div><div class="line">    std::vector&lt;short&gt; buffer(bufferSamples);</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;1000; i++)</div><div class="line">    {</div><div class="line">        m_engine.<a name="a20"></a><a class="code" href="classsidplayfp.html#ac436fcda23b37c6fb03e319d9705947b">play</a>(&amp;buffer.front(), bufferSamples);</div><div class="line">        ::write(handle, &amp;buffer.front(), bufferSize);</div><div class="line">    }</div><div class="line"></div><div class="line">    ::close(handle);</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Feb 12 2021 13:48:24 for libsidplayfp by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
